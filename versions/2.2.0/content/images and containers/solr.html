<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Solr </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Solr ">
    <meta name="generator" content="docfx 2.56.2.0">
    
    <link rel="shortcut icon" href="../../../../images/favicon.png">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../../index.html">
                i2 Analyze Containers
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
          
          <div class="subnav navbar navbar-default">
            <div class="container hide-when-search" id="breadcrumb">
              <ul class="breadcrumb">
                <li></li>
              </ul>
            </div>
          </div>
            <article class="content wrap" id="_content" data-uid="">
<h1 id="solr">Solr</h1>

<p>In a containerized deployment, Solr is configured and run from a Solr image.</p>
<h2 id="configuring-solr">Configuring Solr</h2>
<p>Solr is configured by the <code>solr.xml</code> file. A default <code>solr.xml</code> configuration is generated by the Solr container.</p>
<p>To modify the <code>solr.xml</code>, you can modify the Dockerfile to build an image with your <code>solr.xml</code> file. The Dockerfile in <code>images/solr_redhat</code> contains a commented out example <code>COPY</code> command that copies a <code>solr.xml</code> into the image. By copying a <code>solr.xml</code> file into the image, the container does not generate a default <code>solr.xml</code>.</p>
<p>For more information about the file, see <a href="https://lucene.apache.org/solr/guide/8_5/format-of-solr-xml.html">Format of solr.xml</a>.</p>
<h2 id="building-a-solr-image">Building a Solr image</h2>
<p>The Solr image for i2 Analyze is built from a Dockerfile that is based on the Dockerfile from Apache Solr. The Dockerfile is modified to configure Solr for use with i2 Analyze.</p>
<p>For more information about the Dockerfile provided by Apache Solr, see <a href="https://github.com/docker-solr/docker-solr">docker-solr</a>.</p>
<h3 id="docker-build-command">Docker build command</h3>
<p>The Solr image is built from the Dockerfile in <code>images/solr_redhat</code>.
The following <code>docker build</code> command builds the Solr image:</p>
<pre><code class="lang-bash">docker build -t &quot;solr_redhat:4.3.5&quot; images/solr_redhat
</code></pre><p>For examples of the build commands, see <code>buildImages.sh</code> script.</p>
<h2 id="running-a-solr-container">Running a Solr container</h2>
<p>A Solr container uses the Solr image. In the <code>docker run</code> command, you can use <code>-e</code> to pass environment variables to Solr on the container. The environment variables are described in <a href="#environment-variables">environment variables</a></p>
<p>For more information about the command, see <a href="https://docs.docker.com/engine/reference/run/">docker run reference</a>.</p>
<h3 id="docker-run-command">Docker run command</h3>
<p>The following <code>docker run</code> command runs a Solr server container:</p>
<pre><code class="lang-bash">docker run -d \
   --name &quot;sol1&quot; \
   --net &quot;eia&quot; \
   --net-alias &quot;solr1.eia&quot; \
   --init \
   -p 8983:8983 \
   -v &quot;solr1_data:/var/solr&quot; \
   -v &quot;solr1_secrets:/run/secrets&quot; \
   -e ZK_HOST=&quot;zk1.eia:2281,zk2.eia:2281,zk3.eia:2281&quot; \
   -e SOLR_HOST=&quot;solr1.eia&quot; \
   -e ZOO_DIGEST_USERNAME=&quot;solr&quot; \
   -e ZOO_DIGEST_PASSWORD_FILE=&quot;/run/secrets/ZK_DIGEST_PASSWORD&quot; \
   -e ZOO_DIGEST_READONLY_USERNAME=&quot;readonly-user&quot; \
   -e ZOO_DIGEST_READONLY_PASSWORD_FILE=&quot;/run/secrets/ZK_DIGEST_READONLY_PASSWORD&quot; \
   -e SOLR_ZOO_SSL_CONNECTION=true \
   -e SERVER_SSL=true \
   -e SSL_PRIVATE_KEY_FILE=&quot;/run/secrets/server.key&quot; \
   -e SSL_CERTIFICATE_FILE=&quot;/run/secrets/server.cer&quot; \
   -e SSL_CA_CERTIFICATE_FILE=&quot;/run/secrets/CA.cer&quot; \
   &quot;solr_redhat:4.3.5&quot;
</code></pre><p>For an example of the <code>docker run</code> command, see <a href="https://github.com/i2group/analyze-containers/blob/main/utils/serverFunctions.sh">serverFunctions.sh</a>. The <code>runSolr</code> function takes the following arguments to support running multiple Solr containers:</p>
<ol>
<li><code>CONTAINER</code> - The name for the container.</li>
<li><code>FQDN</code> - The fully qualified domain name for the container and the Solr host.</li>
<li><code>VOLUME</code> - The name for the named volume of the Solr container. For more information, see <a href="#volumes">Volumes</a>.</li>
<li><code>HOST_PORT</code> - The port number on the host machine that is mapped to the port on the container.</li>
</ol>
<p>An example of running Solr container by using <code>runSolr</code> function:</p>
<pre><code class="lang-bash">runSolr solr1 solr1.eia solr1_data 8983
</code></pre><h3 id="volumes">Volumes</h3>
<p>A named volume or a bind mount can be used to persist data and logs that are generated and used in the Solr container, as well as a separate volume for backups, outside of the container.</p>
<p>To configure the Solr container to use the volume, specify the <code>-v</code> option with the name of the volume and the path where the directory is mounted in the container. By setting <code>-v</code> option in the docker run command, a named volume is created. For Solr, the directory that must be mounted is <code>/var/solr</code>.
For example:</p>
<pre><code class="lang-sh">-v solr1_data:/var/solr \
-v solr_backup:/backup \
-v solr1_secrets:/run/secrets
</code></pre><p>A unique volume name must be used for each Solr container.</p>
<p>For more information, see <a href="https://github.com/docker-solr/docker-solr#how-the-image-works">How the image works</a>.</p>
<p><strong>Secrets</strong>:<br>A directory that contains all of the secrets that this tool requires. Specifically this includes credentials to access zookeeper and certificates used in SSL.<br>The directory is used to update the named volume location defined by the <code>CONTAINER_SECRETS_DIR</code> environment variable. This can then be used by other environment variables such as <code>ZOO_DIGEST_USERNAME_FILE</code> to locate the secrets.
In a production environment, the orchestration environment can provide the secrets to the file system or the secrets can be passed in via environment variables. The mechanism that is used here simulates the orchestration system providing the secrets as files.</p>
<h3 id="environment-variables">Environment variables</h3>
<p>To configure Solr, you can provide environment variables to the Docker container in the <code>docker run</code> command.</p>
<h4 id="solr-environment-variables">Solr environment variables</h4>
<p>The following table describes the supported environment variables that you can use for Solr:</p>
<table>
<thead>
<tr>
<th>Environment variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SOLR_HOST</code></td>
<td>Specifies the fully qualified domain name of the Solr container.</td>
</tr>
</tbody>
</table>
<h4 id="zookeeper-authentication">ZooKeeper authentication</h4>
<p>The following environment variables are used to configure Solr to connect to ZooKeeper as a client:</p>
<table>
<thead>
<tr>
<th>Environment variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ZK_HOST</code></td>
<td>Specifies the connection string for each ZooKeeper server to connect to. To connect to more than one ZooKeeper server, the values must be in comma separated list. The connection string must be in the following format: <code>&lt;hostname&gt;:&lt;port&gt;,&lt;hostname&gt;:&lt;port&gt;</code>.</td>
</tr>
<tr>
<td><code>ZOO_DIGEST_USERNAME</code></td>
<td>The ZooKeeper administrator user name. This environment variable maps to the <code>zkDigestUsername</code> system property.</td>
</tr>
<tr>
<td><code>ZOO_DIGEST_PASSWORD</code></td>
<td>The ZooKeeper administrator password. This environment variable maps to the <code>zkDigestPassword</code> system property.</td>
</tr>
<tr>
<td><code>ZOO_DIGEST_READONLY_USERNAME</code></td>
<td>The ZooKeeper read-only user name. This environment variable maps to the <code>zkDigestReadonlyUsername</code> system property.</td>
</tr>
<tr>
<td><code>ZOO_DIGEST_READONLY_PASSWORD</code></td>
<td>The ZooKeeper read-only password. This environment variable maps to the <code>zkDigestReadonlyPassword</code> system property.</td>
</tr>
</tbody>
</table>
<p>For more information about configuring Solr to connect to ZooKeeper, see:</p>
<ul>
<li><a href="https://zookeeper.apache.org/doc/r3.6.2/zookeeperProgrammers.html#sc_java_client_configuration">Client Configuration Parameters</a>.</li>
<li><a href="https://lucene.apache.org/solr/guide/8_5/zookeeper-access-control.html#ZooKeeperAccessControl-bin_solr_solr.cmd_server_scripts_cloud-scripts_zkcli.sh_zkcli.bat">ZooKeeper Access Control</a></li>
</ul>
<h4 id="solr-ssl">Solr SSL</h4>
<p>The following environment variables enable you use SSl with Solr</p>
<table>
<thead>
<tr>
<th>Environment variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SOLR_ZOO_SSL_CONNECTION</code></td>
<td>See below.</td>
</tr>
<tr>
<td><code>SERVER_SSL</code></td>
<td>See <a href="../security%20and%20users/security.html#secure-environment-variables">Secure Environment variables</a>.</td>
</tr>
<tr>
<td><code>SSL_PRIVATE_KEY_FILE</code></td>
<td>See <a href="../security%20and%20users/security.html#secure-environment-variables">Secure Environment variables</a>.</td>
</tr>
<tr>
<td><code>SSL_CERTIFICATE_FILE</code></td>
<td>See <a href="../security%20and%20users/security.html#secure-environment-variables">Secure Environment variables</a>.</td>
</tr>
<tr>
<td><code>SSL_CA_CERTIFICATE_FILE</code></td>
<td>See <a href="../security%20and%20users/security.html#secure-environment-variables">Secure Environment variables</a>.</td>
</tr>
</tbody>
</table>
<p>For more information about the Solr SSL configuration, see <a href="https://lucene.apache.org/solr/guide/8_5/enabling-ssl.html#set-common-ssl-related-system-properties">Set Common SSL-Related System Properties</a>.</p>
<p>For more information about the ZK SSL configuration, see <a href="https://zookeeper.apache.org/doc/r3.6.2/zookeeperProgrammers.html#sc_java_client_configuration">Client Configuration Parameters</a>.</p>
<h2 id="solr-environment-variable-mapping">Solr Environment Variable Mapping</h2>
<p>The above environment variables are either passed through to the standard Solr launch script or used to construct the following Solr environment variables. For exact details see the Docker image.</p>
<ul>
<li><code>SOLR_ZK_CREDS_AND_ACLS</code></li>
<li><code>SOLR_OPTS</code></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            &copy; N. Harris Computer Corporation (2022)
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
