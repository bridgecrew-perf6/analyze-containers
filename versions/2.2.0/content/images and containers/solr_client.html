<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Solr Client </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Solr Client ">
    <meta name="generator" content="docfx 2.56.2.0">
    
    <link rel="shortcut icon" href="../../../../images/favicon.png">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../../index.html">
                i2 Analyze Containers
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
          
          <div class="subnav navbar navbar-default">
            <div class="container hide-when-search" id="breadcrumb">
              <ul class="breadcrumb">
                <li></li>
              </ul>
            </div>
          </div>
            <article class="content wrap" id="_content" data-uid="">
<h1 id="solr-client">Solr Client</h1>

<p>A Solr Client container is an ephemeral container that is used to run Solr commands.</p>
<h2 id="building-a-solr-client-container">Building a Solr Client container</h2>
<p>The Solr Client uses the same image as the Solr Server container. For more information about building the Solr image, see <a href="solr.html">Solr</a>.</p>
<h2 id="running-a-solr-client-container">Running a Solr Client container</h2>
<p>A Solr Client container uses the Solr image. In the <code>docker run</code> command, you can use <code>-e</code> to pass environment variables to Solr on the container. The environment variables are described in <a href="#environment-variables">environment variables</a></p>
<p>For more information about the command, see <a href="https://docs.docker.com/engine/reference/run/">docker run reference</a>.</p>
<h3 id="docker-run-command">Docker run command</h3>
<p>The following <code>docker run</code> command runs a Solr Client container:</p>
<pre><code class="lang-bash">docker run --rm \
    --net &quot;eia&quot; \
    -v &quot;/examples/pre-prod/configuration:/opt/configuration&quot; \
    -e SOLR_ADMIN_DIGEST_USERNAME=&quot;solr&quot; \
    -e SOLR_ADMIN_DIGEST_PASSWORD=&quot;SOLR_ADMIN_DIGEST_PASSWORD&quot; \
    -e ZOO_DIGEST_USERNAME=&quot;solr&quot; \
    -e ZOO_DIGEST_PASSWORD=&quot;ZOO_DIGEST_PASSWORD&quot; \
    -e ZOO_DIGEST_READONLY_USERNAME=&quot;readonly-user&quot; \
    -e ZOO_DIGEST_READONLY_PASSWORD=&quot;ZOO_DIGEST_READONLY_PASSWORD&quot; \
    -e SECURITY_JSON=&quot;SECURITY_JSON&quot; \
    -e SOLR_ZOO_SSL_CONNECTION=true \
    -e SSL_PRIVATE_KEY=&quot;SSL_PRIVATE_KEY&quot; \
    -e SSL_CERTIFICATE=&quot;SSL_CERTIFICATE&quot; \
    -e SSL_CA_CERTIFICATE=&quot;SSL_CA_CERTIFICATE&quot; \
    &quot;solr_redhat:4.3.5&quot; &quot;$@&quot;
</code></pre><p>For an example of the <code>docker run</code> command, see <code>runSolrClientCommand</code> function in <code>clientFunctions.sh</code> script.
For an example of how to use <code>runSolrClientCommand</code> function, see <a href="../tools%20and%20functions/client_functions.html#runSolrClientCommand">runSolrClientCommand</a>.</p>
<h2 id="bind-mounts">Bind mounts</h2>
<p><strong>Secrets</strong>:<br>A directory that contains all of the secrets that this tool requires. Specifically this includes credentials to access zookeeper and certificates used in SSL.<br>The directory is mounted to a location in the container defined by the <code>CONTAINER_SECRETS_DIR</code> environment variable. This can then be used by other environment variables such as <code>ZOO_DIGEST_USERNAME_FILE</code> to locate the secrets.
In a production environment, the orchestration environment can provide the secrets to the file system or the secrets can be passed in via environment variables. The mechanism that is used here simulates the orchestration system providing the secrets as files. This is achieved by using a bind mount. In production this would not be required.</p>
<p><strong>Configuration</strong>:<br>The Solr client requires the i2 Analyze configuration to perform some Solr operations. To access the configuration, the <code>configuration</code> directory must be mounted into the container.</p>
<h2 id="environment-variables">Environment variables</h2>
<p>To configure the Solr client, you can provide environment variables to the Docker container in the <code>docker run</code> command.</p>
<table>
<thead>
<tr>
<th>Environment variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SOLR_ADMIN_DIGEST_USERNAME</code></td>
<td>For usage see <a href="#command-parsing">Command Parsing</a></td>
</tr>
<tr>
<td><code>SOLR_ADMIN_DIGEST_PASSWORD</code></td>
<td>For usage see <a href="#command-parsing">Command Parsing</a></td>
</tr>
<tr>
<td><code>ZOO_DIGEST_USERNAME</code></td>
<td>The ZooKeeper administrator user name. This environment variable maps to the <code>zkDigestUsername</code> system property.</td>
</tr>
<tr>
<td><code>ZOO_DIGEST_PASSWORD</code></td>
<td>The ZooKeeper administrator password. This environment variable maps to the <code>zkDigestPassword</code> system property.</td>
</tr>
<tr>
<td><code>ZOO_DIGEST_READONLY_USERNAME</code></td>
<td>The ZooKeeper read-only user name. This environment variable maps to the <code>zkDigestReadonlyUsername</code> system property.</td>
</tr>
<tr>
<td><code>ZOO_DIGEST_READONLY_PASSWORD</code></td>
<td>The ZooKeeper read-only password. This environment variable maps to the <code>zkDigestReadonlyPassword</code> system property.</td>
</tr>
<tr>
<td><code>SECURITY_JSON</code></td>
<td>The Solr security.json. <a href="../security%20and%20users/security.html#solr-basic-authentication">Solr Basic Authentication</a></td>
</tr>
<tr>
<td><code>SOLR_ZOO_SSL_CONNECTION</code></td>
<td>See <a href="../security%20and%20users/security.html#secure-environment-variables">Secure Environment Variables</a>.</td>
</tr>
<tr>
<td><code>SERVER_SSL</code></td>
<td>See <a href="../security%20and%20users/security.html#secure-environment-variables">Secure Environment Variables</a>.</td>
</tr>
<tr>
<td><code>SSL_PRIVATE_KEY</code></td>
<td>See <a href="../security%20and%20users/security.html#secure-environment-variables">Secure Environment Variables</a>.</td>
</tr>
<tr>
<td><code>SSL_CERTIFICATE</code></td>
<td>See <a href="../security%20and%20users/security.html#secure-environment-variables">Secure Environment Variables</a>.</td>
</tr>
<tr>
<td><code>SSL_CA_CERTIFICATE</code></td>
<td>See <a href="../security%20and%20users/security.html#secure-environment-variables">Secure Environment Variables</a>.</td>
</tr>
</tbody>
</table>
<h2 id="command-parsing">Command parsing</h2>
<p>When commands are passed to the Solr client by using the <code>&quot;$@&quot;</code> notation, the command that is passed to the container must be escaped correctly. On the container, the command is run using <code>docker exec &quot;$@&quot;</code>. Because the command is passed to the <code>docker run</code> command using <code>bash -c</code>, the command must be maintained as a double quoted string.</p>
<p>For example:</p>
<pre><code class="lang-bash">runSolrClientCommand bash -c &quot;curl -u \&quot;\${SOLR_ADMIN_DIGEST_USERNAME}:\${SOLR_ADMIN_DIGEST_PASSWORD}\&quot; 
   --cacert ${CONTAINER_SECRETS_DIR}/CA.cer 
   \&quot;${SOLR1_BASE_URL}/solr/main_index/update?commit=true\&quot; 
   -H Content-Type:text/xml --data-binary \&quot;&lt;delete&gt;&lt;query&gt;*:*&lt;/query&gt;&lt;/delete&gt;\&quot;&quot;
</code></pre><p>Different parts of the command must be escaped in different ways:</p>
<ul>
<li><code>\&quot;\${SOLR_ADMIN_DIGEST_USERNAME}:\${SOLR_ADMIN_DIGEST_PASSWORD}\&quot;</code><br> Because the curl command uses the container&#39;s local environment variables to obtain the values of <code>SOLR_ADMIN_DIGEST_USERNAME</code> and <code>SOLR_ADMIN_DIGEST_PASSWORD</code>, the <code>$</code> is escaped by a <code>\</code>.<br> The <code>&quot;</code> around both of the variables are escaped with a <code>\</code> to prevent the splitting of the command, which means that the variables are evaluated in the container&#39;s environment.</li>
<li><code>\&quot;${SOLR1_BASE_URL}/solr/main_index/update?commit=true\&quot;</code><br> The URL is surrounded in <code>&quot;</code> because the string contains a variable. The <code>&quot;</code> are escaped with a <code>\</code>.<br> Because the <code>SOLR1_FQDN</code> variable is evaluated before it is passed to the container, the <code>$</code> is not escaped.  </li>
<li><code>\&quot;&lt;delete&gt;&lt;query&gt;*:*&lt;/query&gt;&lt;/delete&gt;\&quot;</code><br> The data portion of the curl command is escaped with <code>&quot;</code> because it contains special characters. The <code>&quot;</code> are escaped with a <code>\</code>.</li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            &copy; N. Harris Computer Corporation (2022)
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
