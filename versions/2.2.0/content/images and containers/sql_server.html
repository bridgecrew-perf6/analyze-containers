<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>SQL Server </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="SQL Server ">
    <meta name="generator" content="docfx 2.56.2.0">
    
    <link rel="shortcut icon" href="../../../../images/favicon.png">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../../index.html">
                i2 Analyze Containers
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
          
          <div class="subnav navbar navbar-default">
            <div class="container hide-when-search" id="breadcrumb">
              <ul class="breadcrumb">
                <li></li>
              </ul>
            </div>
          </div>
            <article class="content wrap" id="_content" data-uid="">
<h1 id="sql-server">SQL Server</h1>

<p>In a containerized deployment, the database is located on a SQL Server container.</p>
<h2 id="building-a-sql-server-image">Building a SQL Server image</h2>
<p>SQL Server is built from a Dockerfile that is based on the Dockerfile from <a href="https://hub.docker.com/_/microsoft-mssql-server">Microsoft SQL Server</a>.</p>
<p>The SQL Server image is built from the Dockerfile in <code>images/sql_server</code>.</p>
<h3 id="docker-build-command">Docker build command</h3>
<p>The following <code>docker build</code> command builds the SQL Server image:</p>
<pre><code class="lang-bash">docker build -t &quot;sqlserver_redhat:4.3.5&quot; images/sqlserver
</code></pre><p>For examples of the build commands, see <code>buildImages.sh</code> script.</p>
<h2 id="running-a-sql-server-container">Running a SQL Server container</h2>
<p>A SQL Server container uses the SQL Server image. In the <code>docker run</code> command, you can use <code>-e</code> to pass environment variables to the container. The environment variables are described in <a href="#environment-variables">environment variables</a>.</p>
<p>For more information about the command, see <a href="https://docs.docker.com/engine/reference/run/">docker run reference</a>.</p>
<h3 id="docker-run-command">Docker run command</h3>
<p>The following <code>docker run</code> command runs a SQL Server container:</p>
<pre><code class="lang-bash">docker run -d \
   --name &quot;sqlserver&quot; \
   --network &quot;eia&quot; \
   --net-alias &quot;sqlserver.eia&quot; \
   -p &quot;1433:1433&quot; \
   -v &quot;sqlserver_data:/var/opt/mssql&quot; \
   -v &quot;sqlserver_sqlbackup:/backup&quot; \
   -v &quot;sqlserver_secrets:/run/secrets/&quot; \
   -v &quot;i2a_data:/var/i2a-data&quot; \
   -e ACCEPT_EULA=&quot;Y&quot; \
   -e MSSQL_AGENT_ENABLED=true \
   -e MSSQL_PID=&quot;Developer&quot; \
   -e SA_PASSWORD_FILE=&quot;/run/secrets/SA_PASSWORD_FILE&quot; \
   -e SERVER_SSL=true \
   -e SSL_PRIVATE_KEY_FILE=&quot;/run/secrets/server.key&quot; \
   -e SSL_CERTIFICATE_FILE=&quot;/run/secrets/server.cer&quot; \
   &quot;sqlserver_redhat:4.3.5&quot;
</code></pre><p>For an example of the <code>docker run</code> command, see <a href="https://github.com/i2group/analyze-containers/blob/main/utils/serverFunctions.sh">serverFunctions.sh</a>. The <code>runSQLServer</code> does not take any arguments.</p>
<h3 id="volumes">Volumes</h3>
<p>Named volumes are used to persist data and logs that are generated and used in the SQL Server container, as well as a separate volume for backups, outside of the container.</p>
<blockquote><p>Note: It is good practice to have a separate volume for the backup from the database storage. For more information, see <a href="https://docs.microsoft.com/en-us/sql/relational-databases/backup-restore/back-up-and-restore-of-sql-server-databases?view=sql-server-ver15#best-practice-recommendations">SQL Server Backup best practices</a>.</p>
</blockquote>
<p>To configure the SQL Server container to use these volumes, specify the <code>-v</code> option with the name of the volume and the path where the directory is mounted in the container. By setting <code>-v</code> option in the docker run command, a named volume is created. For SQL Server, the path to the directory that must be mounted is <code>/var/opt/mssql</code>.
For example:</p>
<pre><code class="lang-sh">-v sqlvolume:/var/opt/mssql 
-v sqlserver_sqlbackup:/backup
</code></pre><p>For more information, see <a href="https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-docker-container-configure?view=sql-server-ver15&amp;pivots=cs1-bash#use-data-volume-containers">Use Data Volume Containers</a>.</p>
<ul>
<li><p><strong>Secrets</strong>:<br>A directory that contains all of the secrets that this tool requires. Specifically this includes credentials to access zookeeper and certificates used in SSL.<br>The directory is mounted to a location in the container defined by the <code>CONTAINER_SECRETS_DIR</code> environment variable. This can then be used by other environment variables such as <code>SSL_PRIVATE_KEY_FILE</code> to locate the secrets.<br>In a production environment, the orchestration environment can provide the secrets to the file system or the secrets can be passed in via environment variables. The mechanism that is used here simulates the orchestration system providing the secrets as files. This is achieved by using a bind mount. In production this would not be required.</p>
</li>
<li><p><strong>Example Data</strong>:<br>To demonstrate ingesting data into the Information Store, the i2 Analyze toolkit is mounted to <code>/var/i2a-data</code> in the container.</p>
</li>
</ul>
<h3 id="environment-variables">Environment variables</h3>
<table>
<thead>
<tr>
<th>Environment Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ACCEPT_EULA</code></td>
<td>Set to <code>Y</code> to confirm your acceptance of the <a href="https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-configure-environment-variables?view=sql-server-ver15#environment-variables">End-User Licensing Agreement</a>.</td>
</tr>
<tr>
<td><code>MSSQL_AGENT_ENABLED</code></td>
<td>For more information see <a href="https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-configure-environment-variables?view=sql-server-ver15#environment-variables">Configure SQL Server settings with environment variables on Linux</a></td>
</tr>
<tr>
<td><code>MSSQL_PID</code></td>
<td>For more information see <a href="https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-configure-environment-variables?view=sql-server-ver15#environment-variables">Configure SQL Server settings with environment variables on Linux</a></td>
</tr>
<tr>
<td><code>SA_PASSWORD</code></td>
<td>The administrator user&#39;s password.</td>
</tr>
</tbody>
</table>
<p>The following environment variables enable you to use SSL:</p>
<table>
<thead>
<tr>
<th>Environment variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SERVER_SSL</code></td>
<td>See <a href="../security%20and%20users/security.html#secure-environment-variables">Secure Environment variables</a>.</td>
</tr>
<tr>
<td><code>SSL_PRIVATE_KEY_FILE</code></td>
<td>See <a href="../security%20and%20users/security.html#secure-environment-variables">Secure Environment variables</a>.</td>
</tr>
<tr>
<td><code>SSL_CERTIFICATE_FILE</code></td>
<td>See <a href="../security%20and%20users/security.html#secure-environment-variables">Secure Environment variables</a>.</td>
</tr>
</tbody>
</table>
<p>For more information about the SSL in SQLServer, see <a href="https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-configure-mssql-conf?view=sql-server-ver15#tls">Specify TLS settings</a>.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            &copy; N. Harris Computer Corporation (2022)
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
