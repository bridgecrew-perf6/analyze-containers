<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Loss of the ZooKeeper quorum </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Loss of the ZooKeeper quorum ">
    <meta name="generator" content="docfx 2.56.2.0">
    
    <link rel="shortcut icon" href="../../images/favicon.png">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                i2 Analyze Containers
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
          
          <div class="subnav navbar navbar-default">
            <div class="container hide-when-search" id="breadcrumb">
              <ul class="breadcrumb">
                <li></li>
              </ul>
            </div>
          </div>
            <article class="content wrap" id="_content" data-uid="">
<h1 id="loss-of-the-zookeeper-quorum">Loss of the ZooKeeper quorum</h1>

<p>This walkthrough demonstrates losing more than 50% of the ZooKeeper servers from an ensemble, which causes the loss of the quorum. It also describes how to identify failure, and reinstate high availability with your ZooKeeper ensemble.</p>
<p>Before you begin the walkthrough, there are a number of concepts that it is useful to understand:</p>
<ul>
<li>How ZooKeeper is deployed for high availability and how the ensemble functions when one or more ZooKeeper
servers fail. For more information, see <a href="https://docs.i2group.com/analyze/4.4.0/hadr_zk.html">Configuring ZooKeeper for HADR</a>.</li>
<li>When the ZooKeeper quorum is lost, the Solr cluster also fails. To monitor that whether the ZooKeeper quorum is met or not the component availability log in Liberty is used. The status of Solr is used to determine the status of ZooKeeper.</li>
<li>In a containerized deployment, all log messages are also displayed in the console. You can use the <code>docker logs</code> command to view the console log.</li>
</ul>
<h2 id="simulating-loss-of-quorum">Simulating loss of quorum</h2>
<p>To simulate a loss of quorum, more than 50% of the ZooKeeper servers must be stopped. For example, to stop <code>zk1</code> and <code>zk2</code>, run:</p>
<pre><code class="lang-sh">docker stop zk1 zk2
</code></pre><p>See the <code>Simulating Zookeeper Quorum failure</code> section of the walkthrough script.</p>
<h2 id="detecting-failure">Detecting failure</h2>
<p>When the ZooKeeper quorum is lost, the Solr cluster also fails. The Solr status is reported as <code>DOWN</code>. For more information about losing Solr, see <a href="solr_cluster_failure.html">Failure of the Solr cluster</a>.</p>
<p>The <code>detecting failure</code> section of the walkthrough script runs a loop around the <code>getSolrStatus</code> client function that reports the status of Solr. For more information about the function, see <a href="../tools%20and%20functions/client_functions.html#getsolrstatus"><code>getSolrStatus</code></a>.</p>
<p>The function uses a grep command for the following message that indicates Solr is down:</p>
<pre><code class="lang-Bash">grep -q &quot;^.*[com.i2group.apollo.common.toolkit.internal.ConsoleLogger] - (opal-services) - &#39;.*&#39;, .*&#39;DOWN&#39;&quot;
</code></pre><p>For more information see the <code>Detecting failure</code> section of the walkthrough script.</p>
<h2 id="reinstating-high-availability">Reinstating high availability</h2>
<p>To reinstate high availability to the deployment, restart the failed ZooKeeper servers. In this example, restart the ZooKeeper containers by running the following command:</p>
<pre><code class="lang-sh">docker start zk1 zk2
</code></pre><p>When enough ZooKeeper servers are up to achieve at least a <code>DEGRADED</code> quorum, the status of the i2 Analyze services is <code>ACTIVE</code> and Liberty reports the changes to the Solr cluster status. To ensure the collections recover, monitor the Liberty logs for healthy collections.</p>
<p>See the <code>Reinstating high availability</code> section of the walkthrough script.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            &copy; N. Harris Computer Corporation (2022)
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
